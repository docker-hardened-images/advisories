{
  "modified": "2022-05-30T08:34:22Z",
  "published": "2022-05-19T14:37:43Z",
  "schema_version": "1.5.0",
  "id": "CVE-2022-29170",
  "aliases": [
    "GHSA-9rrr-6fq2-4f99"
  ],
  "details": "Description\r\nToday we are releasing Grafana Enterprise 8.5.3 and 7.5.16. This patch releases includes Moderate severity security fix for Grafana Enterprise which protects against SSRF attack allowing to bypass datasource network restrictions via HTTP redirects.\r\n\r\nRelease v.8.5.3, only containing security fixes:\r\n\r\n[Download Grafana Enterprise 8.5.3](https://grafana.com/grafana/download/8.5.3)\r\n\r\nRelease v.7.5.16, only containing security fixes:\r\n\r\n[Download Grafana Enterprise 7.5.16](https://grafana.com/grafana/download/7.5.16)\r\n\r\n## SSRF - datasource network restrictions bypass via HTTP redirects\r\n\r\nOn 2nd of May, during an internal security audit, we discovered a security vulnerability which impacts Grafana Enterprise instances which are using [Request security](https://grafana.com/docs/grafana/latest/enterprise/request-security/#request-security) feature.\r\n\r\nWe believe that this vulnerability is rated at CVSS 6.6 (CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:H/I:N/A:L).\r\n\r\n### Pre-conditions\r\n\r\n- Running Grafana Enterprise 7.4.0-beta1 - 8.5.2\r\n- [Request security allow list](https://grafana.com/docs/grafana/latest/enterprise/request-security/#allow-list) feature is configured to use at least one  `host_allow_list` or `host_deny_list`\r\n- There is a possibility of adding a custom datasource to Grafana which returns HTTP redirects\r\n\r\n### Summary\r\n\r\nIn Grafana Enterprise,  [Request security allow list](https://grafana.com/docs/grafana/latest/enterprise/request-security/#allow-list) allows to configure Grafana in a way so that the instance doesnâ€™t call or only calls specific hosts. \r\n\r\nThe vulnerability allows to bypass these security configurations if a malicious datasource (running on an allowed host) returns an HTTP redirect to a forbidden host.\r\n\r\n### Impact\r\n\r\nThe vulnerability is only impacting Grafana Enterprise when the [Request security allow list](https://grafana.com/docs/grafana/latest/enterprise/request-security/#allow-list) is used and there is a possibility to add a custom datasource to Grafana which returns HTTP redirects. In this scenario, Grafana would blindly follow the redirects and potentially give secure information to the clients.\r\n\r\n[Grafana Cloud](https://grafana.com/cloud) is not impacted by this vulnerability.\r\n\r\n### Affected versions with MODERATE severity\r\n\r\nAll Grafana Enterprise instances with 7.4.0-beta1 - 8.5.2 versions are affected by this vulnerability.\r\n\r\n### Solutions and mitigations\r\n\r\nAll installations after Grafana Enterprise v7.4.0-beta1 should be upgraded as soon as possible. \r\n\r\n[Grafana Cloud](https://grafana.com/cloud) is not impacted by this vulnerability. and as always, we closely coordinated with all cloud providers licensed to offer Grafana Pro. They have received early notification under embargo and confirmed that their offerings are secure at the time of this announcement. This is applicable to Amazon Managed Grafana and Azure's Grafana as a service offering.\r\n\r\n### Timeline and postmortem\r\n\r\nHere is a detailed timeline starting from when we originally learned of the issue. All times in UTC.\r\n\r\n- 2022-05-02 A potential Issue related to the Request security feature in Grafana Enterprise has been reported internally\r\n- 2022-05-02 12:33 Issue escalated and the vulnerability confirmed reproducible\r\n- 2022-05-02 15:00 Decision is made to release a private patch\r\n- 2022-05-02 15:21 CVE requested\r\n- 2022-05-03 15:58 Private release planned for 2022-05-05, and public release planned for 2022-05-19\r\n\r\n- 2022-05-05 12:00 Private release\r\n- 2022-05-19 12:00 Public release\r\n\r\n## Reporting security issues\r\n\r\nIf you think you have found a security vulnerability, please send a report to [security@grafana.com](mailto:security@grafana.com). This address can be used for all of Grafana Labs's open source and commercial products (including but not limited to Grafana, Grafana Cloud, Grafana Enterprise, and grafana.com). We can accept only vulnerability reports at this address.\r\n\r\nPlease encrypt your message to us; please use our PGP key. The key fingerprint is:\r\n\r\nF988 7BEA 027A 049F AE8E 5CAA D125 8932 BE24 C5CA\r\n\r\nThe key is available from [keyserver.ubuntu.com](https://keyserver.ubuntu.com/pks/lookup?search=0xF9887BEA027A049FAE8E5CAAD1258932BE24C5CA\u0026fingerprint=on\u0026op=index).\r\n\r\nGrafana Labs will send you a response indicating the next steps in handling your report. After the initial reply to your report, the security team will keep you informed of the progress towards a fix and full announcement, and may ask for additional information or guidance.\r\n\r\n**Important:** We ask you to not disclose the vulnerability before it have been fixed and announced, unless you received a response from the Grafana Labs security team that you can do so.\r\n\r\n## Security announcements\r\n\r\nWe maintain a category on the community site called [Security Announcements](https://community.grafana.com/c/support/security-announcements),\r\nwhere we will post a summary, remediation, and mitigation details for any patch containing security fixes.\r\n\r\nYou can also subscribe to email updates to this category if you have a grafana.com account and sign on to the community site or track updates via an [RSS feed](https://community.grafana.com/c/support/security-announcements.rss).",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "grafana",
        "purl": "pkg:dhi/grafana"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "7.4.0"
            },
            {
              "fixed": "7.5.16"
            },
            {
              "introduced": "8.0.0"
            },
            {
              "fixed": "8.5.3"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "grafana",
        "source_package": "request security"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/grafana/grafana/security/advisories/GHSA-9rrr-6fq2-4f99"
    }
  ]
}