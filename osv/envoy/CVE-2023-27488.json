{
  "modified": "2023-04-04T14:49:43Z",
  "published": "2023-04-04T14:49:43Z",
  "schema_version": "1.5.0",
  "id": "CVE-2023-27488",
  "aliases": [
    "GHSA-9g5w-hqr3-w2ph"
  ],
  "details": "### Impact\r\n\r\nEscalation of Privileges when `failure_mode_allow: true` is configured for `ext_authz` filter. For affected components that are used for logging and/or visibility, requests may not be logged by the receiving service.\r\n\r\n### Affected components\r\n\r\n`ext_authz`, `ext_proc`, `tap`, `ratelimit` filters and gRPC access log service.\r\n\r\n### Attack vector/s\r\n\r\nThe attacker can use this vulnerability to bypass auth checks when `ext_authz` is used.\r\n\r\n### Description\r\n\r\nWhen Envoy was configured to use ext_authz, ext_proc, tap, ratelimit filters, and grpc access log service and an http header with non-UTF-8 data was received, Envoy would generate an invalid protobuf message and send it to the configured service. The receiving service would typically generate an error when decoding the protobuf message. \r\n\r\nFor ext_authz that was configured with ``failure_mode_allow: true``, the request would have been allowed in this case. \r\n\r\nFor the other services, this could have resulted in other unforseen errors such as a lack of visibility into requests (eg request not logged). \r\n\r\nEnvoy will now by default sanitize the values sent in gRPC service calls to be valid UTF-8, replacing data that is not valid UTF-8 with a `!` character.\r\nThis behavioral change can be temporarily reverted by setting runtime guard `envoy.reloadable_features.service_sanitize_non_utf8_strings` to false.\r\n\r\n### Example exploit or proof-of-concept\r\n\r\nSending a request with non-UTF-8 header values will reproduce this issue when an gRPC upstream is configured.\r\n\r\n### Mitigation\r\n\r\nSetting `failure_mode_allow: false` for `ext_authz`.\r\n\r\n### Discoverer/credits\r\n\r\nMarek Szlagor \u003cmarekszlagor@gmail.com\u003e\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.22.9"
            },
            {
              "introduced": "1.23.0"
            },
            {
              "fixed": "1.23.6"
            },
            {
              "introduced": "1.24.0"
            },
            {
              "fixed": "1.24.4"
            },
            {
              "introduced": "1.25.0"
            },
            {
              "fixed": "1.25.3"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "envoy",
        "source_package": "Envoy"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-9g5w-hqr3-w2ph"
    }
  ]
}