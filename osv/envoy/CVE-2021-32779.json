{
  "modified": "2021-08-24T19:28:47Z",
  "published": "2021-08-24T19:28:47Z",
  "schema_version": "1.5.0",
  "id": "CVE-2021-32779",
  "aliases": [
    "GHSA-r222-74fw-jqr9"
  ],
  "details": "CVSS score 8.6 (High), Vector: [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N)\r\n\r\nEnvoy incorrectly handled a URI '#fragment' element as part of the path element.\r\n\r\nEnvoy is configured with an RBAC filter for authorization or similar mechanism with an\r\nexplicit case of a final \"/admin\" path element, or is using a negative assertion with\r\nfinal path element of \"/admin\". The client sends request to \"/app1/admin#foo\"\r\n\r\nIn Envoy prior to 1.18.0, or 1.18.0+ configured with path_normalization=false\r\nEnvoy treats fragment as a suffix of the query string when present, or as a suffix\r\nof the path when query string is absent, so it evaluates the final path element\r\nas \"/admin#foo\" and mismatches with the configured \"/admin\" path element\r\n\r\nIn Envoy 1.18.0+ configured with path_normalization=true\r\nEnvoy transforms this to /app1/admin%23foo and mismatches with the configured /admin prefix\r\n\r\nThe resulting URI is sent to the next server-agent with the offending \"#foo\" fragment which\r\nviolates RFC3986 or with the nonsensical \"%23foo\" text appended.\r\n\r\n### Impact\r\nEscalation of Privileges when path based request authorization extensions.\r\n\r\n### Attack vector\r\nA specifically constructed request with URI containing '#fragment' element delivered by an untrusted client in the presence of path based request authorization.\r\n\r\n### Patches\r\nEnvoy versions 1.19.1, 1.18.4, 1.17.4, 1.16.5 contain fixes that removes fragment from URI path in incoming requests.\r\n\r\n### Workarounds\r\nNone\r\n\r\n### Credits\r\nYangmin Zhu ymzhu@google.com\r\n\r\n### References\r\nhttps://blog.envoyproxy.io\r\nhttps://github.com/envoyproxy/envoy/releases\r\n\r\n### For more information\r\nIf you have any questions or comments about this advisory:\r\n\r\nOpen an issue in [Envoy repo](https://github.com/envoyproxy/envoy/issues)\r\nEmail us at [envoy-security](envoy-security@googlegroups.com)",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "1.16.4"
            },
            {
              "fixed": "1.16.5"
            },
            {
              "introduced": "1.17.3"
            },
            {
              "fixed": "1.17.4"
            },
            {
              "introduced": "1.18.3"
            },
            {
              "fixed": "1.18.4"
            },
            {
              "introduced": "1.19.0"
            },
            {
              "fixed": "1.19.1"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "",
        "source_package": ""
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-r222-74fw-jqr9"
    }
  ]
}