{
  "modified": "2024-09-19T15:02:12Z",
  "published": "2024-09-19T15:02:12Z",
  "schema_version": "1.5.0",
  "id": "CVE-2024-45810",
  "aliases": [
    "GHSA-qm74-x36m-555q"
  ],
  "details": "### Summary\r\n\r\nEnvoy will crash when the HTTP async client is handling `sendLocalReply` under some circumstance, e.g., WebSocket upgrade, and requests mirroring. \r\n\r\n### Details\r\n\r\nThe HTTP async client can crash during the `sendLocalReply()` in HTTP async client.\r\n\r\nOne reason is HTTP async client is duplicating the status code, and another is the router is destroyed at the destructor of the async stream, while the stream is deferred deleted at first.\r\n\r\nThis can create a problem where the stream decoder is destroyed but its reference is called in `router.onDestroy()`, causing a segfault.\r\n\r\nThis can impact ext_authz if the `upgrade` and `connection` header are allowed, and request mirrorring is enabled.\r\n\r\n### PoC\r\n\r\n* config `allowed_headers` to match any headers or\r\n```\r\n    patterns:\r\n    - exact: upgrade\r\n    - exact: connection\r\n ```\r\n* Send WebSocket upgrade requests\r\n* The authentication server sends back `400` to reject the auth request.\r\n* Then Envoy will crash\r\n\r\n\r\n### Impact\r\n\r\nEnvoy will crash to stop serving any traffic\r\n\r\n### Credits\r\n\r\nNick Van Dyck (nick.vandyck@intigriti.com)",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.28.7"
            },
            {
              "introduced": "1.29.0"
            },
            {
              "fixed": "1.29.9"
            },
            {
              "introduced": "1.30.0"
            },
            {
              "fixed": "1.30.6"
            },
            {
              "introduced": "1.31.0"
            },
            {
              "fixed": "1.31.2"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "",
        "source_package": "Envoy"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-qm74-x36m-555q"
    }
  ]
}