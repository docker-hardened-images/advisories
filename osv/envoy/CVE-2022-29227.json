{
  "modified": "2022-06-09T16:17:27Z",
  "published": "2022-06-09T16:17:27Z",
  "schema_version": "1.5.0",
  "id": "CVE-2022-29227",
  "aliases": [
    "GHSA-rm2p-qvf6-pvr6"
  ],
  "details": "# Attack type\r\nRemote\r\n\r\n# Impact\r\nDenial of Service (crash)\r\n\r\n# Affected component(s)\r\nHTTP processing, when internal redirects are configured.\r\n\r\n# Attack vector(s)\r\nRemote\r\n\r\n# Discoverer(s)/Credits\r\n Artur Molchanov  arturmolchanov@gmail.com\r\n\r\n# Description (brief; included in CVE)\r\nEnvoy internal redirects for requests with bodies or trailers are not safe if the redirect prompts an Envoy-generated local reply.\r\n\r\n# Example exploit or proof-of-concept\r\nAn example of when Envoy would send a local reply for internal redirects: if a client sends a non-headers-only request which results in a redirect, and the request redirects to a route configured for local replies, Envoy will send the local reply on processing the redirect headers.  Due to a bug in the redirect logic, on sending that local reply, Envoy will attempt to reset the (completed, and deleted) downstream stream.\r\n\r\n# Description (full; not included in CVE but will be published on GitHub later and linked)\r\nIf Envoy attempts to send an internal redirect of an HTTP request consisting of more than HTTP headers, thereâ€™s a lifetime bug which can be triggered.  If while replaying the request Envoy sends a local reply when the redirect headers are processed, the downstream state indicates that the downstream stream is not complete.  On sending the local reply, Envoy will attempt to reset the upstream stream, but as it is actually complete, and deleted, this result in a use-after-free.\r\n\r\n# Mitigation\r\nDisable internal redirects if crashes are observed.\r\n\r\n# Detection\r\nCrashes with recreateStream in the call stack\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.22.1"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "envoy",
        "source_package": "Envoy"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-rm2p-qvf6-pvr6"
    }
  ]
}