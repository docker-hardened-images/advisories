{
  "modified": "2023-12-04T08:28:24Z",
  "published": "2023-12-04T08:28:24Z",
  "schema_version": "1.5.0",
  "id": "CVE-2023-47106",
  "aliases": [
    "GHSA-fvhj-4qfh-q2hm"
  ],
  "details": "### Summary\r\nWhen a request is sent to Traefik with a URL fragment, Traefik automatically URL encodes and forwards the fragment to the backend server. This violates the RFC because in the origin-form the URL should only contain the absolute path and the query.\r\n\r\nWhen this is combined with another frontend proxy like Nginx, it can be used to bypass frontend proxy URI-based access control\r\nrestrictions. \r\n\r\n### Details\r\nFor example, we have this Nginx configuration:\r\n\r\n```\r\nlocation /admin {\r\n     deny all;\r\n     return 403;\r\n}\r\n```\r\nThis can be bypassed when the attacker is requesting to /#/../admin\r\n\r\nThis wonâ€™t be vulnerable if the backend server follows the RFC and ignores any characters after the fragment.\r\n\r\nHowever, if Nginx is chained with another reverse proxy which automatically URL encode the character # (Traefik) the URL will become\r\n\r\n/%23/../admin\r\n\r\nAnd allow the attacker to completely bypass the Access Restriction from the Nginx Front-End proxy.\r\n\r\nHere is a diagram to summarize the attack:\r\n\r\n![image](https://user-images.githubusercontent.com/47447167/278849578-34ca0546-99b4-44c8-8fc8-8e799c1f5069.png)\r\n\r\n### PoC\r\n![image (1)](https://user-images.githubusercontent.com/47447167/278849597-280f2e80-f2d7-4dd9-9662-b8f488fd5ff2.png)\r\n\r\nThis is the POC docker I've set up.  It contains Nginx, Traefik proxies and a backend server running PHP.\r\n\r\nhttps://drive.google.com/file/d/1vLnA0g7N7ZKhLNmHmuJ4JJjV_J2akNMt/view?usp=sharing\r\n\r\n### Impact\r\nThis allows the attacker to completely bypass the Access Restriction from Front-End proxy.\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "traefik",
        "purl": "pkg:dhi/traefik"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "2.10.6"
            },
            {
              "introduced": "3.0.0"
            },
            {
              "fixed": "3.0.0-beta5"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "go",
        "source_package": "Traefik"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/traefik/traefik/security/advisories/GHSA-fvhj-4qfh-q2hm"
    }
  ]
}