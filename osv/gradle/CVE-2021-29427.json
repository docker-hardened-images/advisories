{
  "modified": "2021-04-10T00:30:37Z",
  "published": "2021-04-10T00:30:37Z",
  "schema_version": "1.5.0",
  "id": "CVE-2021-29427",
  "aliases": [
    "GHSA-jvmj-rh6q-x395"
  ],
  "details": "We would like to thank @ZacSweers from @slackhq for making us aware of this security issue.\r\n\r\n### Impact\r\n\r\nRepository content filtering is a security control Gradle introduced to help users specify what repositories are used to resolve specific dependencies. This feature was introduced in the wake of the \"[A Confusing Dependency](https://blog.autsoft.hu/a-confusing-dependency/)\" blog post.\r\n\r\nIn some cases, Gradle may ignore content filters and search all repositories for dependencies. This only occurs when repository content filtering is used from within a `pluginManagement` block in a settings file. This may change how dependencies are resolved for Gradle plugins and build scripts.\r\n\r\nFor builds that are vulnerable, there are two risks:\r\n* Information disclosure: Gradle could make dependency requests to repositories outside your organization and leak internal package identifiers.\r\n* Dependency poisoning/Dependency confusion: Gradle could download a malicious binary from a repository outside your organization due to name squatting.\r\n\r\n### Example\r\nThese examples demonstrate vulnerable builds. You would find this usually inside of a settings.gradle or settings.gradle.kts file.\r\n\r\nUsing an exclusive content filter: \r\n```gradle\r\npluginManagement {\r\n    repositories {\r\n        exclusiveContent {\r\n            forRepository {\r\n                maven {\r\n                    name = \"JCenter\"\r\n                    setUrl(\"https://jcenter.bintray.com/\")\r\n                }\r\n            }\r\n            filter {\r\n                includeModule(\"org.jetbrains.kotlinx\", \"kotlinx-html-jvm\")\r\n                includeGroup(\"org.jetbrains.dokka\")\r\n                includeModule(\"org.jetbrains\", \"markdown\")\r\n            }\r\n        }\r\n        mavenCentral()\r\n        gradlePluginPortal()\r\n    }\r\n }\r\n```\r\n\r\nUsing an content filter on the repository itself:\r\n```gradle\r\npluginManagement {\r\n  repositories {\r\n    jcenter {\r\n      content {\r\n        includeModule(\"org.jetbrains.kotlinx\", \"kotlinx-html-jvm\")\r\n        includeGroup(\"org.jetbrains.dokka\")\r\n        includeModule(\"org.jetbrains\", \"markdown\")\r\n      }\r\n    }\r\n    mavenCentral()\r\n    gradlePluginPortal()\r\n  }\r\n}\r\n```\r\n\r\nIn both examples, the modules \"org.jetbrains.kotlinx:kotlinx-html-jvm\" and \"org.jetbrains:markdown\" and all modules from group \"org.jetbrains.dokka\" should be resolved from JCenter. Due to the bug/vulnerability, Gradle will attempt to resolve the dependencies from all repositories. \r\n\r\n### What should you do? \r\n\r\n### Upgrade to Gradle 7.0\r\n\r\nThe problem has been patched and released with Gradle 7.0.\r\nUsers relying on this feature should upgrade their build as soon as possible.\r\n\r\n#### Workaround for older versions\r\n\r\n* Use a company repository which has the right rules for fetching packages from public repositories.\r\n* Use project level repository content filtering, inside `buildscript.repositories`. This option is available since Gradle 5.1 when the feature was introduced.\r\n\r\n### References\r\n- [CWE-829: Inclusion of Functionality from Untrusted Control Sphere](https://cwe.mitre.org/data/definitions/829.html)\r\n- [A Confusing Dependency](https://blog.autsoft.hu/a-confusing-dependency/)\r\n- [Dependency Confusion](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)\r\n\r\n\r\n### Questions?\r\n\r\n* For security related issues, please email us at security@gradle.com.\r\n* For non-security related issues, please open an issue on [GitHub](https://github.com/gradle/gradle/issues/new/choose).\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "gradle",
        "purl": "pkg:dhi/gradle"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "5.1.0"
            },
            {
              "fixed": "7.0.0"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "java",
        "source_package": "Gradle"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/gradle/gradle/security/advisories/GHSA-jvmj-rh6q-x395"
    }
  ]
}