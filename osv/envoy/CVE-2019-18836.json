{
  "modified": "2019-11-09T16:55:40Z",
  "published": "2019-11-09T16:55:40Z",
  "schema_version": "1.5.0",
  "id": "CVE-2019-18836",
  "aliases": [
    "GHSA-3xvf-4396-cj46"
  ],
  "details": "# Vulnerability type\r\nCWE-834: Excessive Iteration\r\n\r\n# Attack type\r\nRemote\r\n\r\n# Impact\r\nDenial of Service\r\n\r\n# Affected component(s)\r\nListener filters\r\n\r\n# Attack vector(s)\r\nAn attacker can create a TCP connection to listeners configured with `continue_on_listener_filters_timeout` true, wait for Envoy hitting the listener timeout and burn 1 core for the worker thread.\r\n\r\n# Discoverer(s)/Credits\r\nYuchen Dai, Google\r\n\r\n# References\r\nInitial GitHub Issue: https://github.com/istio/istio/issues/18229\r\n\r\n# Description (brief; included in CVE)\r\n\r\nUpon serving idle TCP connection, Envoy with certain listener filter configs will end up watching writable event with level trigger. If the corresponding network filter chain, such as the most common HttpConnManager will put worker thread in the infinite busy loop. A remote attacker only need to maintain 1 idle connection to consume up to 1 CPU core at Envoy server. \r\n\r\nCVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H (7.5, High)\r\n\r\n# Description (full; not included in CVE but will be published on GitHub later and linked)\r\nEnvoy may register two set of interested socket events when going through listener filter chain and network filter chain. In the above scenario envoy would trap into the situation that be interests in WriteEvent with LevelTrigger but no data to write. Envoy would consume excessive cpu at endless immediate returning syscalls. \r\n\r\n## Proof-of-Concept Exploit:\r\nRun envoy config with `tls_inspector`, `listenerFiltersTimeout`, `continueOnListenerFiltersTimeout`, and a match all `http_connection_manager`\r\nRun `nc \u003cenvoy_address\u003e \u003cenvoy_port\u003e`, and keep the connection idle no shorter than `listenerFiltersTimeout`\r\n\r\n# Mitigation\r\nSet continueOnListenerFiltersTimeout to false. \r\n\r\n# Detection\r\nExcessive cpu consumption on certain worker thread\r\nSignificant high %CPU sys\r\n`strace -c -f -p $\u003cenvoy_pid\u003e` has very high number of fast return epoll_wait calls.\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "1.12.0"
            },
            {
              "fixed": "1.12.1"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "",
        "source_package": ""
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-3xvf-4396-cj46"
    }
  ]
}