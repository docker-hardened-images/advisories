{
  "modified": "2023-02-01T16:37:29Z",
  "published": "2023-02-01T16:37:29Z",
  "schema_version": "1.5.0",
  "id": "CVE-2022-23498",
  "aliases": [
    "GHSA-2j8f-6whh-frc8"
  ],
  "details": "## Summary\r\n\r\nWhen datasource query caching is enabled, Grafana caches all headers, including when rotating the Grafana session cookie via a  `Set-Cookie grafana_session` header. As a result, any user could receive the cached session cookie of someone else if the response to the first datasource query contained a session cookie rotation header.\r\n\r\n### Steps to reproduce\r\n\r\n1. Enable datasource query caching\r\n1. Make a targeted request to the affected endpoint (ex: https://localhost:3000/api/datasources/134/resources/api/v1/series\r\n    - The request must be done with a session cookie older than the rotation interval (default 10 minutes).\r\n    - The response will include x-cache:MISS as a header and also the Set-Cookie header\r\n1. The following requests to this endpoint will return this first user's new grafana session cookie during the cache lifetime, 5 minutes by default.\r\n\r\n### Mitigations\r\n\r\nTo fully address CVE-2022-23498 please upgrade your Grafana instances. As an alternative, you could disable datasource query caching for all datasources.\r\n\r\n### Affected Versions\r\n\r\nGrafana Enterprise \u003e=8.3.0-beta1\r\n\r\n## Reporting security issues\r\n\r\nIf you think you have found a security vulnerability, please send a report to security@grafana.com. This address can be used for all of Grafana Labs' open source and commercial products (including, but not limited to Grafana, Grafana Cloud, Grafana Enterprise, and grafana.com). We can accept only vulnerability reports at this address. We would prefer that you encrypt your message to us by using our PGP key. The key fingerprint is\r\n\r\nF988 7BEA 027A 049F AE8E 5CAA D125 8932 BE24 C5CA\r\n\r\nThe key is available from keyserver.ubuntu.com.\r\n\r\n## Security announcements\r\n\r\nWe maintain a [security category](https://community.grafana.com/c/support/security-announcements) on our blog, where we will always post a summary, remediation, and mitigation details for any patch containing security fixes.\r\n\r\nYou can also subscribe to our [RSS feed](https://grafana.com/tags/security/index.xml).\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "grafana",
        "purl": "pkg:dhi/grafana"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "8.3.0-beta1"
            },
            {
              "fixed": "9.2.10"
            },
            {
              "introduced": "9.3.0"
            },
            {
              "fixed": "9.3.4"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/grafana/grafana/security/advisories/GHSA-2j8f-6whh-frc8"
    }
  ]
}