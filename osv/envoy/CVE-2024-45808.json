{
  "modified": "2024-09-19T15:01:51Z",
  "published": "2024-09-19T15:01:51Z",
  "schema_version": "1.5.0",
  "id": "CVE-2024-45808",
  "aliases": [
    "GHSA-p222-xhp9-39rc"
  ],
  "details": "### Summary\r\n\r\nA vulnerability has been identified in Envoy that allows malicious attackers to inject unexpected content into access logs.\r\n\r\nThis is achieved by exploiting the lack of validation for the `REQUESTED_SERVER_NAME` field for access loggers.\r\n\r\n### PoC\r\n\r\nIn our default access log format, the primary arbitrary input fields are headers. \r\n\r\n`REQUESTED_SERVER_NAME` also can take arbitrary inputs and has no validation in Envoy at all (despite the RFC being pretty strict). \r\n\r\nFurther, this is externally exploitable  as will be logged in majority of cases, even if RBAC denies.\r\n\r\nAn example exploit:\r\n\r\n```\r\nblue='\\e[0;34m'\r\nx=$(echo -e $blue)\r\nclient https://10.36.1.114/ --server-name \"[foo.com](http://foo.com/)${x}this is blue\r\nend\u003cscript\u003ealert()\u003c/script\u003e\r\n[2022-01-05T17:14:26.823Z] fake log\"\r\n```\r\n\r\nThis has 3 in one:\r\n\r\n* Inject ANSI escape characters. Here it makes `kubectl` logs return blue text; cursor movement is also possible. Above probably only works on zsh, but others support them as well with different syntax. Cursor movement allows deleting logs, masking an attack\r\n* Inject HTML - I don't know of any log viewers that are subject to this, but its plausible.\r\n* Inject new lines, which allows inject fake logs\r\n\r\n### Impact\r\n\r\nLog injection to our system will cause multiple unexpected problems\r\n",
  "affected": [
    {
      "package": {
        "ecosystem": "DHI",
        "name": "envoy",
        "purl": "pkg:dhi/envoy"
      },
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "1.28.7"
            },
            {
              "introduced": "1.29.0"
            },
            {
              "fixed": "1.29.9"
            },
            {
              "introduced": "1.30.0"
            },
            {
              "fixed": "1.30.6"
            },
            {
              "introduced": "1.31.0"
            },
            {
              "fixed": "1.31.2"
            }
          ]
        }
      ],
      "database_specific": {
        "source_ecosystem": "",
        "source_package": "Envoy"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/envoyproxy/envoy/security/advisories/GHSA-p222-xhp9-39rc"
    }
  ]
}